<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Space-Time Cube with Mapbox Base Map and Data</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
  <script type="module">
    import * as THREE from 'https://cdn.skypack.dev/three@0.132.2/build/three.module.js';
    import { OrbitControls } from 'https://cdn.skypack.dev/three@0.132.2/examples/jsm/controls/OrbitControls.js';

    // Create a Three.js scene
    const scene = new THREE.Scene();

    // Create a camera
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 300, 300);
    camera.lookAt(scene.position);

    // Create a renderer
    const renderer = new THREE.WebGLRenderer({ alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Load Mapbox tile texture for the base plane
    const textureLoader = new THREE.TextureLoader();
    const mapboxTexture = textureLoader.load('https://api.mapbox.com/styles/v1/mapbox/streets-v11/static/77.5946,12.9716,10,0,0/512x512?access_token=pk.eyJ1IjoicG9vcm5pLWJhZHJpbmF0aCIsImEiOiJjanUwbmYzc3UwdDI3NGRtZ3kzMTltbWZpIn0.SB9PEksVcEwWvZJ9A7J9uA');

    // Create a base map plane
    const planeSize = 200; // Adjust plane size
    const planeGeometry = new THREE.PlaneGeometry(planeSize, planeSize);
    const planeMaterial = new THREE.MeshBasicMaterial({ map: mapboxTexture });
    const plane = new THREE.Mesh(planeGeometry, planeMaterial);
    plane.rotation.x = -Math.PI / 2; // Rotate the plane to make it flat
    plane.position.y = -planeSize / 2; // Position the plane at the base
    scene.add(plane);

    // Create point materials
    const greenMaterial = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
    const redMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });

    // Load your data here and process it as needed
    const data = [
      [13.0099295, 77.5510424, 12.937277, 77.623006, 10],  // Bangalore Palace to Koramangala
      [12.996302, 77.569264, 12.916508, 77.621199, 15],   // Bangalore Palace to Silk Board
      [12.995638, 77.696144, 13.007321, 77.580828, 25],   // Bangalore Palace to Kengeri
      [12.92797, 77.582962, 13.043513, 77.620982, 20]
    ];

// Define color legend entries
const color_legend = {
  'green': "Driving Time: < 30 mins",
  'yellow': "Driving Time: 30 - 60 mins",
  'red': "Driving Time: 60 - 90 mins",
  'maroon': "Driving Time: > 90 mins"
};

// Create the width ranges for legend
const width_ranges = [
  [0, 3],
  [30, 5],
  [60, 7],
  [90, 9]
];


// Create the width legend
const width_legend = {
  3: "Line Width: 3",
  5: "Line Width: 5",
  7: "Line Width: 7",
  9: "Line Width: 9"
};


    
    // Function to create a route line between two points
    function createRouteLine(start, end, color, width) {
      const lineGeometry = new THREE.BufferGeometry().setFromPoints([start, end]);
      const lineMaterial = new THREE.LineBasicMaterial({ color, linewidth: width });
      const routeLine = new THREE.Line(lineGeometry, lineMaterial);
      scene.add(routeLine);
    }

    // Loop through the data and create route lines
    for (let i = 0; i < data.length; i++) {
      const start = new THREE.Vector3(data[i].origin_longitude, data[i].driving_time * 10, data[i].origin_latitude);
      const end = new THREE.Vector3(data[i].destination_longitude, data[i].driving_time * 10, data[i].destination_latitude);
      const color = new THREE.Color(color_legend[width_legend[width_ranges[0][1]]]);
      const width = width_ranges[0][1];
      createRouteLine(start, end, color, width);
    }

    // Create orbit controls to navigate the scene
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;


    // Render loop
    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();

    

    // Handle window resize
    window.addEventListener('resize', function () {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

console.log("origin_lat_long:", origin_lat_long);
console.log("destination_lat_long:", destination_lat_long);
console.log("driving_times:", driving_times);
  </script>
</body>
</html>
